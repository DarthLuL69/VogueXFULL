<div class="max-w-6xl mx-auto p-5">
  <h1 class="text-4xl font-bold mb-5 text-center">Tienda</h1>
  <div class="flex flex-col md:flex-row gap-8">
    <!-- Filtros -->
    <aside class="w-full md:w-64 flex-shrink-0">

      <!-- Department Filter -->
      <div class="border-b border-gray-200 pb-4 mb-4 last:border-b-0 last:mb-0">
        <h3 class="text-lg font-semibold mb-2 cursor-pointer flex justify-between items-center" (click)="toggleFilter('department')">
          Department
          <svg class="w-4 h-4 transition-transform duration-300" [class.rotate-180]="isFilterExpanded('department')" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </h3>
        <div class="text-sm" *ngIf="isFilterExpanded('department')">
          <label class="flex items-center cursor-pointer">
            <input type="checkbox" class="mr-2"
                  [checked]="selectedCategory === 'menswear'"
                  (change)="onCategoryChange('menswear', $event)">
            Menswear
          </label>
          <label class="flex items-center cursor-pointer">
            <input type="checkbox" class="mr-2"
                  [checked]="selectedCategory === 'womenswear'"
                  (change)="onCategoryChange('womenswear', $event)">
            Womenswear
          </label>
          <label class="flex items-center cursor-pointer">
            <input type="checkbox" class="mr-2"
                  [checked]="selectedCategory === 'sneakers'"
                  (change)="onCategoryChange('sneakers', $event)">
            Footwear
          </label>
        </div>
      </div>

      <!-- Category Filter -->
      <div class="border-b border-gray-200 pb-4 mb-4 last:border-b-0 last:mb-0">
        <h3 class="text-lg font-semibold mb-2 cursor-pointer flex justify-between items-center" (click)="toggleFilter('category')">
          Category
          <svg class="w-4 h-4 transition-transform duration-300" [class.rotate-180]="isFilterExpanded('category')" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </h3>
        <div class="text-sm" *ngIf="isFilterExpanded('category')">
          <!-- Categorías principales -->
          <div class="mb-4">
            <label class="flex items-center cursor-pointer mb-2">
              <input type="checkbox" class="mr-2"
                    [checked]="selectedCategory === 'menswear'"
                    (change)="onCategoryChange('menswear', $event)">
              <span class="font-medium">Menswear</span>
            </label>
            
            <!-- Subcategorías de Menswear -->
            <div *ngIf="selectedCategory === 'menswear'" class="ml-4 space-y-1">
              <ng-container *ngFor="let group of Object.keys(getCategoryGroups())">
                <div class="mt-3">
                  <p class="font-semibold text-xs uppercase text-gray-700 mb-1">{{ group }}</p>
                  <div class="space-y-1">
                    <label *ngFor="let subcategory of getCategoryGroups()[group]" 
                           class="flex items-center cursor-pointer">
                      <input type="checkbox" class="mr-2"
                            [checked]="isSubcategorySelected(subcategory)"
                            (change)="onSubcategoryChange(subcategory, $event)">
                      <span class="text-sm">{{ subcategory }}</span>
                    </label>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>

          <div class="mb-4">
            <label class="flex items-center cursor-pointer mb-2">
              <input type="checkbox" class="mr-2"
                    [checked]="selectedCategory === 'womenswear'"
                    (change)="onCategoryChange('womenswear', $event)">
              <span class="font-medium">Womenswear</span>
            </label>
            
            <!-- Subcategorías de Womenswear -->
            <div *ngIf="selectedCategory === 'womenswear'" class="ml-4 space-y-1">
              <ng-container *ngFor="let group of Object.keys(getCategoryGroups())">
                <div class="mt-3">
                  <p class="font-semibold text-xs uppercase text-gray-700 mb-1">{{ group }}</p>
                  <div class="space-y-1">
                    <label *ngFor="let subcategory of getCategoryGroups()[group]" 
                           class="flex items-center cursor-pointer">
                      <input type="checkbox" class="mr-2"
                            [checked]="isSubcategorySelected(subcategory)"
                            (change)="onSubcategoryChange(subcategory, $event)">
                      <span class="text-sm">{{ subcategory }}</span>
                    </label>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>

          <div class="mb-4">
            <label class="flex items-center cursor-pointer mb-2">
              <input type="checkbox" class="mr-2"
                    [checked]="selectedCategory === 'sneakers'"
                    (change)="onCategoryChange('sneakers', $event)">
              <span class="font-medium">Footwear</span>
            </label>
            
            <!-- Subcategorías de Sneakers/Footwear -->
            <div *ngIf="selectedCategory === 'sneakers'" class="ml-4 space-y-1">
              <ng-container *ngFor="let group of Object.keys(getCategoryGroups())">
                <div class="mt-3">
                  <p class="font-semibold text-xs uppercase text-gray-700 mb-1">{{ group }}</p>
                  <div class="space-y-1">
                    <label *ngFor="let subcategory of getCategoryGroups()[group]" 
                           class="flex items-center cursor-pointer">
                      <input type="checkbox" class="mr-2"
                            [checked]="isSubcategorySelected(subcategory)"
                            (change)="onSubcategoryChange(subcategory, $event)">
                      <span class="text-sm">{{ subcategory }}</span>
                    </label>
                  </div>
                </div>
              </ng-container>
            </div>
          </div>
        </div>
      </div>

      <!-- Size Filter -->
       <div class="border-b border-gray-200 pb-4 mb-4 last:border-b-0 last:mb-0">
        <h3 class="text-lg font-semibold mb-2 cursor-pointer flex justify-between items-center" (click)="toggleFilter('size')">
          Size
          <svg class="w-4 h-4 transition-transform duration-300" [class.rotate-180]="isFilterExpanded('size')" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </h3>
        <div class="text-sm" *ngIf="isFilterExpanded('size')">
          <!-- Mostrar información de categoría seleccionada -->
          <div *ngIf="selectedCategory" class="mb-3">
            <p class="font-semibold text-xs uppercase text-gray-700 mb-2">
              {{ selectedCategory }}
              <span *ngIf="selectedSubcategory"> - {{ selectedSubcategory.replace('-', ' ') | titlecase }}</span>
            </p>
            <p class="text-xs text-gray-500 mb-2">{{ getSizeType() }}</p>
          </div>
          
          <!-- Tallas dinámicas -->
          <div *ngIf="hasSizesAvailable()" class="grid grid-cols-3 gap-2">
            <label *ngFor="let size of getAvailableSizes()" class="flex items-center cursor-pointer">
              <input type="checkbox" class="mr-2">
              <span class="text-sm">{{ size }}</span>
            </label>
          </div>
          
          <!-- Mensaje si no hay categoría seleccionada -->
          <div *ngIf="!selectedCategory" class="text-gray-500 text-sm">
            Selecciona una categoría para ver las tallas disponibles
          </div>
        </div>
      </div>

      <!-- Designers Filter -->
      <div class="border-b border-gray-200 pb-4 mb-4 last:border-b-0 last:mb-0">
        <h3 class="text-lg font-semibold mb-2 cursor-pointer flex justify-between items-center" (click)="toggleFilter('designers')">
          Designers
          <svg class="w-4 h-4 transition-transform duration-300" [class.rotate-180]="isFilterExpanded('designers')" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </h3>
        <div class="text-sm" *ngIf="isFilterExpanded('designers')">
          <!-- Designer search with autocomplete -->
          <div class="relative mb-3">
            <input 
              type="text" 
              placeholder="Search for designers..." 
              [formControl]="designerSearchControl"
              (focus)="onDesignerSearchFocus()"
              (blur)="onDesignerSearchBlur()"
              class="w-full p-2 pr-8 border border-gray-300 rounded-md text-sm focus:outline-none focus:border-black">
            <div class="absolute inset-y-0 right-0 flex items-center pr-3">
              <svg class="w-4 h-4 text-gray-500" fill="none" stroke="currentColor" viewBox="0 0 24 24">
                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-3.5-3.5M10 17a7 7 0 100-14 7 7 0 000 14z"></path>
              </svg>
            </div>
            
            <!-- Designer suggestions dropdown -->
            <div *ngIf="showDesignerSuggestions" 
                 class="absolute z-20 w-full bg-white border border-gray-300 rounded-md shadow-lg mt-1 max-h-48 overflow-y-auto">
              <div *ngFor="let designer of designerSuggestions" 
                   class="p-2 hover:bg-gray-100 cursor-pointer flex items-center space-x-2"
                   (click)="selectDesigner(designer)">
                <img [src]="designer.imageUrl" 
                     [alt]="designer.name"
                     class="w-6 h-6 rounded object-cover"
                     onerror="this.src='https://via.placeholder.com/24x24?text=' + this.alt.charAt(0)">
                <div class="flex-1">
                  <span class="font-medium">{{ designer.name }}</span>
                  <span class="text-xs text-gray-500 ml-2">({{ designer.itemsCount }} items)</span>
                </div>
              </div>
            </div>
          </div>

          <!-- Selected designers -->
          <div *ngIf="selectedDesigners.length > 0" class="mb-3">
            <p class="text-xs font-semibold text-gray-700 mb-2">SELECTED DESIGNERS:</p>
            <div class="flex flex-wrap gap-1">
              <span *ngFor="let designer of selectedDesigners" 
                    class="inline-flex items-center px-2 py-1 bg-black text-white text-xs rounded-md">
                {{ designer }}
                <button (click)="removeSelectedDesigner(designer)" class="ml-1 text-white hover:text-gray-300">
                  <svg class="w-3 h-3" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M4.293 4.293a1 1 0 011.414 0L10 8.586l4.293-4.293a1 1 0 111.414 1.414L11.414 10l4.293 4.293a1 1 0 01-1.414 1.414L10 11.414l-4.293 4.293a1 1 0 01-1.414-1.414L8.586 10 4.293 5.707a1 1 0 010-1.414z" clip-rule="evenodd"></path>
                  </svg>
                </button>
              </span>
            </div>
          </div>

          <!-- All designers list (checkbox style) -->
          <div class="mb-2">
            <p class="text-xs font-semibold text-gray-700 mb-2">ALL DESIGNERS:</p>
            <ul class="list-none p-0 m-0 max-h-52 overflow-y-auto">
              <li *ngFor="let designer of designers" class="mb-2 last:mb-0">
                <label class="flex items-center cursor-pointer">
                  <input type="checkbox" 
                         class="mr-2" 
                         [checked]="isDesignerSelected(designer)"
                         (change)="onDesignerCheckboxChange(designer, $event)">
                  {{ designer }}
                </label>
              </li>
            </ul>
          </div>
        </div>
      </div>

      <!-- Price Filter -->
      <div class="border-b border-gray-200 pb-4 mb-4 last:border-b-0 last:mb-0">
        <h3 class="text-lg font-semibold mb-2 cursor-pointer flex justify-between items-center" (click)="toggleFilter('price')">
          Price
          <svg class="w-4 h-4 transition-transform duration-300" [class.rotate-180]="isFilterExpanded('price')" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7"></path></svg>
        </h3>
         <div class="text-sm" *ngIf="isFilterExpanded('price')">
            <div class="flex gap-2">
              <input type="text" placeholder="€ Min" class="w-1/2 p-2 border border-gray-300 rounded-md text-center focus:outline-none focus:border-black">
              <input type="text" placeholder="€ Max" class="w-1/2 p-2 border border-gray-300 rounded-md text-center focus:outline-none focus:border-black">
            </div>
        </div>
      </div>

    </aside>

    <!-- Lista de productos -->
    <div class="flex-1">
      <div *ngIf="products.length > 0" class="grid grid-cols-1 sm:grid-cols-2 lg:grid-cols-3 xl:grid-cols-4 gap-6">
        <!-- Productos -->
        <div *ngFor="let product of products" class="group relative bg-white rounded-lg shadow-md overflow-hidden hover:shadow-lg transition-shadow">
          <div class="aspect-w-1 aspect-h-1 w-full overflow-hidden">
            <img 
              [src]="getProductImage(product)" 
              [alt]="product.name" 
              class="h-64 w-full object-cover object-center group-hover:opacity-75 transition-opacity"
              (error)="onImageError($event)">
          </div>
          
          <!-- Badge de origen -->
          <div class="absolute top-2 left-2">
            <span *ngIf="product.source === 'local'" class="bg-green-500 text-white text-xs px-2 py-1 rounded-full">
              Local
            </span>
            <span *ngIf="product.source === 'grailed'" class="bg-blue-500 text-white text-xs px-2 py-1 rounded-full">
              Grailed
            </span>
          </div>

          <div class="p-4">
            <!-- Información del producto -->
            <div class="mb-3">
              <p class="text-xs text-gray-500 mb-1">{{ product.timeAgo || '' }}</p>
              <h3 class="text-sm font-semibold text-gray-900 mb-1 line-clamp-2">{{ product.name }}</h3>
              <p class="text-sm text-gray-600 mb-2">{{ product.brand || 'Sin marca' }}</p>
              
              <!-- Mostrar talla si está disponible -->
              <p *ngIf="product.size" class="text-xs text-gray-500 mb-2">Talla: {{ product.size }}</p>
              
              <div class="flex items-center justify-between">
                <div>
                  <p class="text-lg font-bold text-gray-900">
                    €{{ product.price }}
                  </p>
                  <span *ngIf="product.originalPrice" class="text-sm text-gray-500 line-through">
                    €{{ product.originalPrice }}
                  </span>
                </div>
                <button (click)="toggleFavorite(product)" class="text-gray-400 hover:text-red-500 focus:outline-none">
                  <svg [class.text-red-500]="isFavorite(product.id)" class="h-6 w-6" fill="currentColor" viewBox="0 0 20 20">
                    <path fill-rule="evenodd" d="M3.172 5.172a4 4 0 015.656 0L10 6.343l1.172-1.171a4 4 0 115.656 5.656L10 17.657l-6.828-6.829a4 4 0 010-5.656z" clip-rule="evenodd" />
                  </svg>
                </button>
              </div>
            </div>

            <!-- Botones de acción -->
            <div class="space-y-2">
              <!-- Botón para productos locales -->
              <button 
                *ngIf="product.source === 'local'"
                (click)="sendOffer(product)"
                class="w-full bg-black text-white py-2 px-4 rounded-md text-sm font-medium hover:bg-gray-800 transition-colors">
                Enviar Oferta
              </button>
              
              <!-- Botón para productos de Grailed -->
              <button 
                *ngIf="product.source === 'grailed'"
                (click)="viewOnGrailed(product)"
                class="w-full bg-blue-600 text-white py-2 px-4 rounded-md text-sm font-medium hover:bg-blue-700 transition-colors">
                Ver en Grailed
              </button>
            </div>
          </div>
        </div>
      </div>
      
      <div *ngIf="products.length === 0" class="text-center py-12">
        <div class="text-gray-500">
          <svg class="mx-auto h-12 w-12 text-gray-400 mb-4" fill="none" viewBox="0 0 24 24" stroke="currentColor">
            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M20 13V6a2 2 0 00-2-2H6a2 2 0 00-2 2v7m16 0v5a2 2 0 01-2 2H6a2 2 0 01-2-2v-5m16 0h-2M4 13h2m0 0V9a2 2 0 012-2h2m0 0V6a2 2 0 012-2h2.5" />
          </svg>
          <p>No se encontraron productos.</p>
          <p class="text-sm mt-2">
            <a routerLink="/sell" class="text-blue-500 hover:underline">¿Quieres vender algo?</a>
          </p>
        </div>
      </div>
    </div>
  </div>
</div>